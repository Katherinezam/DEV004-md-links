export const mdLinks = (path, options) => {

  // Absot c:/archivos/katy/file.md
// Realtivo     katy/file.md
//  c:/archivos/katy/file.md

    return new Promise((resolve, reject) => {

        if (existeRuta(path)) {
    
            if (esRutaAbsoluta(path)) {
                extraerLinkdelMd(path,options)
                

            } else {
                const rutaAbsoluta = convertirRutaAbsoluta(path); 
            
                if (esRutaAbsoluta(rutaAbsoluta)) {
                    extraerLinkdelMd(path,options)
                } 
            }

            

        } else {
            reject(new Error(`La ruta (x) no existe`));
            //fin
        }

    
    });
};

function extraerLinkdelMd(path,options){
    
    if (esArchivoMd(path)){
        console.log('La ruta es un archivo .md');

        // Ler archivo md
        //Tienes link?
            // SI -> extraer link

                // Tiene Link?
                    //SI -> Los almaceno en unaarray con un formato
                    
                        // Tiene la opcion Validate? (options.validate == true )
                            // SI ->  Validas links haciendo peticiones http de cada uno
                                    // La llamda http retorno un status de exito ?
                                        // si -> Adicionar un campo al objeto del array (status) con el valor "ok"

                                        // No - > Adicionar un campo al objeto del array (status) con el valor  "Fail"

                                        //  Retorna promesa con el array (Formato de cadaobejto  "hrf" , "Text", "file", "status" ) de los  links - Fin (Flujo Ok)
                                    
                            
                            // No ->  Retorna promesa con el array (Formato "hrf" , "Text", "file" ) de los  links - Fin (Flujo Ok)

                    // NO -> Mersaje de Error -> Fin
                    
                       
            // No -> Mensaje error y  Fin

    } else {
        // Convertimos la ruta relativa en una ruta absoluta 
       reject ('La ruta no es un archivo .md');
       //fin
    }
}


import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';
// import marked from 'marked';
import axios from 'axios';
import { log } from 'console';

//Esta ruta existe,retorna T/F
const existsRoute = (route) => fs.existsSync(route);

//Es una ruta absoluta, retorna T/F
const isAbsolute = (route) => path.isAbsolute(route);

//Convertir de ruta relativa  a ruta absoluta. aqui usare opererador ternario.
const convertToAbsolute = (route) => (isAbsolute(route) ? route : path.resolve(route));


//---función expresada para  obtener una lista de todos los archivos de  dentro y fuera de un directorio  -------------------------

const getAllFiles = function (dirPath) {
    let arrayOfFiles = [];
    let files = fs.readdirSync(dirPath);
    const __filename = fileURLToPath(import.meta.url);
    const __dirname = path.dirname(__filename);

    files.forEach((file) => {
        if (fs.statSync(dirPath + "/" + file).isDirectory()){
            arrayOfFiles.push(...getAllFiles(dirPath + "/" + file))
        } else {
            arrayOfFiles.push(path.join(__dirname, dirPath, "/", file))
        }
    });

    return arrayOfFiles;
}

//-------- función para obtener un array  de archivos md ---------------
const getOnlyMds = function(){
    const getAllFilesMds = getAllFiles(dirPath);
    const mdsOnly = getAllFilesMds.filter((file) => {
        return path.extname(file) === ".md";
    });
     
    if(mdsOnly.length === 0) {
        console.log('Error: no existe archivos md');
    }
}

//--------recibo un archivo markdown y quiero extraer  ---------
const extractLinksFromMdFile = function(path, callback){
    //Lee el contenido del archivo Markdown de forma asíncrona.
    fs.readFile(path, 'utf8',(err, markdown)=>{
        if (err) {
            callback(err);
        } else {
          //Analiza el contenido del archivo con marked
          const analyzeContent = marked.Lexer(markdown);

          //Recorrer el arbol AST y busaca nodos que representen enlaces
          const links = analyzeContent.filter(node => node.type === 'link');

          //Extrae la informacion del enlace de cada nodo encontrado
          const linksInformation = links.map(link => ({
            text:link.text,
            href: link.href
          }));
          callback(null, linksInformation);
        }
    });
}
//--------- validar los links---------------


//Checar options.



export {
    existsRoute,
    isAbsolute,
    convertToAbsolute,
    getAllFiles,

}